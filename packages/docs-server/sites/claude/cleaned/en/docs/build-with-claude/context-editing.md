[Claude Docs home page![light logo](https://mintcdn.com/anthropic-claude-docs/DcI2Ybid7ZEnFaf0/logo/light.svg?fit=max&auto=format&n=DcI2Ybid7ZEnFaf0&q=85&s=c877c45432515ee69194cb19e9f983a2)![dark logo](https://mintcdn.com/anthropic-claude-docs/DcI2Ybid7ZEnFaf0/logo/dark.svg?fit=max&auto=format&n=DcI2Ybid7ZEnFaf0&q=85&s=f5bb877be0cb3cba86cf6d7c88185216)](/)
![US](https://d3gk2c5xim1je2.cloudfront.net/flags/US.svg)
English
Search...
⌘K
Search...
Navigation
Capabilities
Context editing
[Welcome](/en/home)[Claude Developer Platform](/en/docs/intro)[Claude Code](/en/docs/claude-code/overview)[Model Context Protocol (MCP)](/en/docs/mcp)[API Reference](/en/api/messages)[Resources](/en/resources/overview)[Release Notes](/en/release-notes/overview)
* [](/en/docs/intro)
* [](/en/api/overview)
##### First steps
 * [Intro to Claude](/en/docs/intro)
 * [Quick start](/en/docs/get-started)
##### Models & pricing
 * [Models overview](/en/docs/about-claude/models/overview)
 * [Choosing a model](/en/docs/about-claude/models/choosing-a-model)
 * [What's new in Claude 4.5](/en/docs/about-claude/models/whats-new-claude-4-5)
 * [Migrating to Claude 4.5](/en/docs/about-claude/models/migrating-to-claude-4)
 * [Model deprecations](/en/docs/about-claude/model-deprecations)
 * [Pricing](/en/docs/about-claude/pricing)
##### Learn about Claude
 * [Features overview](/en/docs/build-with-claude/overview)
 * [Building with Claude](/en/docs/overview)
 * [Context windows](/en/docs/build-with-claude/context-windows)
 * [Glossary](/en/docs/about-claude/glossary)
##### Capabilities
 * [Prompt caching](/en/docs/build-with-claude/prompt-caching)
 * [Context editing](/en/docs/build-with-claude/context-editing)
 * [Extended thinking](/en/docs/build-with-claude/extended-thinking)
 * [Streaming Messages](/en/docs/build-with-claude/streaming)
 * [Batch processing](/en/docs/build-with-claude/batch-processing)
 * [Citations](/en/docs/build-with-claude/citations)
 * [Multilingual support](/en/docs/build-with-claude/multilingual-support)
 * [Token counting](/en/docs/build-with-claude/token-counting)
 * [Embeddings](/en/docs/build-with-claude/embeddings)
 * [Vision](/en/docs/build-with-claude/vision)
 * [PDF support](/en/docs/build-with-claude/pdf-support)
 * [Files API](/en/docs/build-with-claude/files)
 * [Search results](/en/docs/build-with-claude/search-results)
 * [Google Sheets add-on](/en/docs/agents-and-tools/claude-for-sheets)
##### Tools
 * [Overview](/en/docs/agents-and-tools/tool-use/overview)
 * [How to implement tool use](/en/docs/agents-and-tools/tool-use/implement-tool-use)
 * [Token-efficient tool use](/en/docs/agents-and-tools/tool-use/token-efficient-tool-use)
 * [Fine-grained tool streaming](/en/docs/agents-and-tools/tool-use/fine-grained-tool-streaming)
 * [Bash tool](/en/docs/agents-and-tools/tool-use/bash-tool)
 * [Code execution tool](/en/docs/agents-and-tools/tool-use/code-execution-tool)
 * [Computer use tool](/en/docs/agents-and-tools/tool-use/computer-use-tool)
 * [Text editor tool](/en/docs/agents-and-tools/tool-use/text-editor-tool)
 * [Web fetch tool](/en/docs/agents-and-tools/tool-use/web-fetch-tool)
 * [Web search tool](/en/docs/agents-and-tools/tool-use/web-search-tool)
 * [Memory tool](/en/docs/agents-and-tools/tool-use/memory-tool)
##### Agent Skills
 * [Overview](/en/docs/agents-and-tools/agent-skills/overview)
 * [Quickstart](/en/docs/agents-and-tools/agent-skills/quickstart)
 * [Best practices](/en/docs/agents-and-tools/agent-skills/best-practices)
##### Model Context Protocol (MCP)
 * [MCP connector](/en/docs/agents-and-tools/mcp-connector)
 * [Remote MCP servers](/en/docs/agents-and-tools/remote-mcp-servers)
##### Use cases
 * [Overview](/en/docs/about-claude/use-case-guides/overview)
 * [Ticket routing](/en/docs/about-claude/use-case-guides/ticket-routing)
 * [Customer support agent](/en/docs/about-claude/use-case-guides/customer-support-chat)
 * [Content moderation](/en/docs/about-claude/use-case-guides/content-moderation)
 * [Legal summarization](/en/docs/about-claude/use-case-guides/legal-summarization)
##### Prompt engineering
 * [Overview](/en/docs/build-with-claude/prompt-engineering/overview)
 * [Claude 4 best practices](/en/docs/build-with-claude/prompt-engineering/claude-4-best-practices)
 * [Prompt generator](/en/docs/build-with-claude/prompt-engineering/prompt-generator)
 * [Use prompt templates](/en/docs/build-with-claude/prompt-engineering/prompt-templates-and-variables)
 * [Prompt improver](/en/docs/build-with-claude/prompt-engineering/prompt-improver)
 * [Be clear and direct](/en/docs/build-with-claude/prompt-engineering/be-clear-and-direct)
 * [Use examples (multishot prompting)](/en/docs/build-with-claude/prompt-engineering/multishot-prompting)
 * [Let Claude think (CoT)](/en/docs/build-with-claude/prompt-engineering/chain-of-thought)
 * [Use XML tags](/en/docs/build-with-claude/prompt-engineering/use-xml-tags)
 * [Give Claude a role (system prompts)](/en/docs/build-with-claude/prompt-engineering/system-prompts)
 * [Prefill Claude's response](/en/docs/build-with-claude/prompt-engineering/prefill-claudes-response)
 * [Chain complex prompts](/en/docs/build-with-claude/prompt-engineering/chain-prompts)
 * [Long context tips](/en/docs/build-with-claude/prompt-engineering/long-context-tips)
 * [Extended thinking tips](/en/docs/build-with-claude/prompt-engineering/extended-thinking-tips)
##### Test & evaluate
 * [Define success criteria](/en/docs/test-and-evaluate/define-success)
 * [Develop test cases](/en/docs/test-and-evaluate/develop-tests)
 * [Using the Evaluation Tool](/en/docs/test-and-evaluate/eval-tool)
 * [Reducing latency](/en/docs/test-and-evaluate/strengthen-guardrails/reduce-latency)
##### Strengthen guardrails
 * [Reduce hallucinations](/en/docs/test-and-evaluate/strengthen-guardrails/reduce-hallucinations)
 * [Increase output consistency](/en/docs/test-and-evaluate/strengthen-guardrails/increase-consistency)
 * [Mitigate jailbreaks](/en/docs/test-and-evaluate/strengthen-guardrails/mitigate-jailbreaks)
 * [Streaming refusals](/en/docs/test-and-evaluate/strengthen-guardrails/handle-streaming-refusals)
 * [Reduce prompt leak](/en/docs/test-and-evaluate/strengthen-guardrails/reduce-prompt-leak)
 * [Keep Claude in character](/en/docs/test-and-evaluate/strengthen-guardrails/keep-claude-in-character)
On this page
 * [How it works](#how-it-works)
 * [Supported models](#supported-models)
 * [Basic usage](#basic-usage)
 * [Advanced configuration](#advanced-configuration)
 * [Configuration options](#configuration-options)
 * [Response format](#response-format)
 * [Token counting](#token-counting)
 * [Using with the Memory Tool](#using-with-the-memory-tool)
Context editing is currently in beta with support for tool result clearing. To enable it, use the beta header `context-management-2025-06-27` in your API requests. Additional context editing strategies will be added in future releases.Please reach out through our [feedback form](https://forms.gle/YXC2EKGMhjN1c4L88) to share your feedback on this feature.
## 
[​](#how-it-works)
How it works
The `clear_tool_uses_20250919` strategy clears tool results when conversation context grows beyond your configured threshold. When activated, the API automatically clears the oldest tool results in chronological order, replacing them with placeholder text to let Claude know the tool result was removed. By default, only tool results are cleared. You can optionally clear both tool results and tool calls (the tool use parameters) by setting `clear_tool_inputs` to true.
**Context editing happens server-side** Context editing is applied **server-side** before the prompt reaches Claude. Your client application maintains the full, unmodified conversation history—you do not need to sync your client state with the edited version. Continue managing your full conversation history locally as you normally would.
**Context editing and prompt caching** Context editing invalidates cached prompt prefixes because clearing content modifies the prompt structure, breaking the match requirement for cache hits. To account for this, we recommend clearing enough tokens to make the cache invalidation worthwhile. Use the `clear_at_least` parameter to ensure a minimum number of tokens is cleared each time. When using [prompt caching](/en/docs/build-with-claude/prompt-caching) with context editing, you’ll incur cache write costs each time content is cleared, but subsequent requests can reuse the newly cached prefix.
## 
[​](#supported-models)
Supported models
Context editing is available on:
 * Claude Opus 4.1 (`claude-opus-4-1-20250805`)
 * Claude Opus 4 (`claude-opus-4-20250514`)
 * Claude Sonnet 4.5 (`claude-sonnet-4-5-20250929`)
 * Claude Sonnet 4 (`claude-sonnet-4-20250514`)
 * Claude Haiku 4.5 (`claude-haiku-4-5-20251001`)
## 
[​](#basic-usage)
Basic usage
The simplest way to enable context editing is to specify only the strategy type, as all other [configuration options](#configuration-options) will use their default values:
cURL
Python
TypeScript
Copy
```
curl https://api.anthropic.com/v1/messages \
 --header "x-api-key: $ANTHROPIC_API_KEY" \
 --header "anthropic-version: 2023-06-01" \
 --header "content-type: application/json" \
 --header "anthropic-beta: context-management-2025-06-27" \
 --data '{
 "model": "claude-sonnet-4-5",
 "max_tokens": 4096,
 "messages": [
 {
 "role": "user",
 "content": "Search for recent developments in AI"
 }
 ],
 "tools": [
 {
 "type": "web_search_20250305",
 "name": "web_search"
 }
 ],
 "context_management": {
 "edits": [
 {"type": "clear_tool_uses_20250919"}
 ]
 }
 }'
```
## 
[​](#advanced-configuration)
Advanced configuration
You can customize the context editing behavior with additional parameters:
cURL
Python
TypeScript
Copy
```
curl https://api.anthropic.com/v1/messages \
 --header "x-api-key: $ANTHROPIC_API_KEY" \
 --header "anthropic-version: 2023-06-01" \
 --header "content-type: application/json" \
 --header "anthropic-beta: context-management-2025-06-27" \
 --data '{
 "model": "claude-sonnet-4-5",
 "max_tokens": 4096,
 "messages": [
 {
 "role": "user",
 "content": "Create a simple command line calculator app using Python"
 }
 ],
 "tools": [
 {
 "type": "text_editor_20250728",
 "name": "str_replace_based_edit_tool",
 "max_characters": 10000
 },
 {
 "type": "web_search_20250305",
 "name": "web_search",
 "max_uses": 3
 }
 ],
 "context_management": {
 "edits": [
 {
 "type": "clear_tool_uses_20250919",
 "trigger": {
 "type": "input_tokens",
 "value": 30000
 },
 "keep": {
 "type": "tool_uses",
 "value": 3
 },
 "clear_at_least": {
 "type": "input_tokens",
 "value": 5000
 },
 "exclude_tools": ["web_search"]
 }
 ]
 }
 }'
```
## 
[​](#configuration-options)
Configuration options
Configuration option | Default | Description 
---|---|--- 
`trigger` | 100,000 input tokens | Defines when the context editing strategy activates. Once the prompt exceeds this threshold, clearing will begin. You can specify this value in either `input_tokens` or `tool_uses`. 
`keep` | 3 tool uses | Defines how many recent tool use/result pairs to keep after clearing occurs. The API removes the oldest tool interactions first, preserving the most recent ones. 
`clear_at_least` | None | Ensures a minimum number of tokens is cleared each time the strategy activates. If the API can’t clear at least the specified amount, the strategy will not be applied. This helps determine if context clearing is worth breaking your prompt cache. 
`exclude_tools` | None | List of tool names whose tool uses and results should never be cleared. Useful for preserving important context. 
`clear_tool_inputs` | `false` | Controls whether the tool call parameters are cleared along with the tool results. By default, only the tool results are cleared while keeping Claude’s original tool calls visible. 
## 
[​](#response-format)
Response format
You can see which context edits were applied to your request using the `context_management` response field, along with helpful statistics about the content and input tokens cleared.
Response
Copy
```
{
 "id": "msg_013Zva2CMHLNnXjNJJKqJ2EF",
 "type": "message",
 "role": "assistant",
 "content": [...],
 "usage": {...},
 "context_management": {
 "applied_edits": [
 {
 "type": "clear_tool_uses_20250919",
 "cleared_tool_uses": 8,
 "cleared_input_tokens": 50000
 }
 ]
 }
}
```
For streaming responses, the context edits will be included in the final `message_delta` event:
Streaming Response
Copy
```
{
 "type": "message_delta",
 "delta": {
 "stop_reason": "end_turn",
 "stop_sequence": null
 },
 "usage": {
 "output_tokens": 1024
 },
 "context_management": {
 "applied_edits": [...]
 }
}
```
## 
[​](#token-counting)
Token counting
The [token counting](/en/docs/build-with-claude/token-counting) endpoint supports context management, allowing you to preview how many tokens your prompt will use after context editing is applied.
cURL
Python
TypeScript
Copy
```
curl https://api.anthropic.com/v1/messages/count_tokens \
 --header "x-api-key: $ANTHROPIC_API_KEY" \
 --header "anthropic-version: 2023-06-01" \
 --header "content-type: application/json" \
 --header "anthropic-beta: context-management-2025-06-27" \
 --data '{
 "model": "claude-sonnet-4-5",
 "messages": [
 {
 "role": "user",
 "content": "Continue our conversation..."
 }
 ],
 "tools": [...],
 "context_management": {
 "edits": [
 {
 "type": "clear_tool_uses_20250919",
 "trigger": {
 "type": "input_tokens",
 "value": 30000
 },
 "keep": {
 "type": "tool_uses",
 "value": 5
 }
 }
 ]
 }
 }'
```
Response
Copy
```
{
 "input_tokens": 25000,
 "context_management": {
 "original_input_tokens": 70000
 }
}
```
The response shows both the final token count after context management is applied (`input_tokens`) and the original token count before any clearing occurred (`original_input_tokens`).
## 
[​](#using-with-the-memory-tool)
Using with the Memory Tool
Context editing can be combined with the [memory tool](/en/docs/agents-and-tools/tool-use/memory-tool). When your conversation context approaches the configured clearing threshold, Claude receives an automatic warning to preserve important information. This enables Claude to save tool results or context to its memory files before they’re cleared from the conversation history. This combination allows you to:
 * **Preserve important context** : Claude can write essential information from tool results to memory files before those results are cleared
 * **Maintain long-running workflows** : Enable agentic workflows that would otherwise exceed context limits by offloading information to persistent storage
 * **Access information on demand** : Claude can look up previously cleared information from memory files when needed, rather than keeping everything in the active context window
For example, in a file editing workflow where Claude performs many operations, Claude can summarize completed changes to memory files as the context grows. When tool results are cleared, Claude retains access to that information through its memory system and can continue working effectively. To use both features together, enable them in your API request:
Python
TypeScript
Copy
```
response = client.beta.messages.create(
 model="claude-sonnet-4-5",
 max_tokens=4096,
 messages=[...],
 tools=[
 {
 "type": "memory_20250818",
 "name": "memory"
 },
 # Your other tools
 ],
 betas=["context-management-2025-06-27"],
 context_management={
 "edits": [
 {"type": "clear_tool_uses_20250919"}
 ]
 }
)
```
Was this page helpful?
YesNo
[Prompt caching](/en/docs/build-with-claude/prompt-caching)[Extended thinking](/en/docs/build-with-claude/extended-thinking)
Assistant
Responses are generated using AI and may contain mistakes.