Agent Skills are now available! [Learn more about extending Claude's capabilities with Agent Skills](/en/docs/agents-and-tools/agent-skills/overview).
[Claude Docs home page![light logo](https://mintcdn.com/anthropic-claude-docs/DcI2Ybid7ZEnFaf0/logo/light.svg?fit=max&auto=format&n=DcI2Ybid7ZEnFaf0&q=85&s=c877c45432515ee69194cb19e9f983a2)![dark logo](https://mintcdn.com/anthropic-claude-docs/DcI2Ybid7ZEnFaf0/logo/dark.svg?fit=max&auto=format&n=DcI2Ybid7ZEnFaf0&q=85&s=f5bb877be0cb3cba86cf6d7c88185216)](/)
![US](https://d3gk2c5xim1je2.cloudfront.net/flags/US.svg)
English
Search...
⌘K
Search...
Navigation
Capabilities
Streaming Messages
[Welcome](/en/home)[Claude Developer Platform](/en/docs/intro)[Claude Code](/en/docs/claude-code/overview)[Model Context Protocol (MCP)](/en/docs/mcp)[API Reference](/en/api/messages)[Resources](/en/resources/overview)[Release Notes](/en/release-notes/overview)
* [](/en/docs/intro)
* [](/en/api/overview)
##### First steps
 * [Intro to Claude](/en/docs/intro)
 * [Quick start](/en/docs/get-started)
##### Models & pricing
 * [Models overview](/en/docs/about-claude/models/overview)
 * [Choosing a model](/en/docs/about-claude/models/choosing-a-model)
 * [What's new in Claude 4.5](/en/docs/about-claude/models/whats-new-claude-4-5)
 * [Migrating to Claude 4.5](/en/docs/about-claude/models/migrating-to-claude-4)
 * [Model deprecations](/en/docs/about-claude/model-deprecations)
 * [Pricing](/en/docs/about-claude/pricing)
##### Learn about Claude
 * [Features overview](/en/docs/build-with-claude/overview)
 * [Building with Claude](/en/docs/overview)
 * [Context windows](/en/docs/build-with-claude/context-windows)
 * [Glossary](/en/docs/about-claude/glossary)
##### Capabilities
 * [Prompt caching](/en/docs/build-with-claude/prompt-caching)
 * [Context editing](/en/docs/build-with-claude/context-editing)
 * [Extended thinking](/en/docs/build-with-claude/extended-thinking)
 * [Streaming Messages](/en/docs/build-with-claude/streaming)
 * [Batch processing](/en/docs/build-with-claude/batch-processing)
 * [Citations](/en/docs/build-with-claude/citations)
 * [Multilingual support](/en/docs/build-with-claude/multilingual-support)
 * [Token counting](/en/docs/build-with-claude/token-counting)
 * [Embeddings](/en/docs/build-with-claude/embeddings)
 * [Vision](/en/docs/build-with-claude/vision)
 * [PDF support](/en/docs/build-with-claude/pdf-support)
 * [Files API](/en/docs/build-with-claude/files)
 * [Search results](/en/docs/build-with-claude/search-results)
 * [Google Sheets add-on](/en/docs/agents-and-tools/claude-for-sheets)
##### Tools
 * [Overview](/en/docs/agents-and-tools/tool-use/overview)
 * [How to implement tool use](/en/docs/agents-and-tools/tool-use/implement-tool-use)
 * [Token-efficient tool use](/en/docs/agents-and-tools/tool-use/token-efficient-tool-use)
 * [Fine-grained tool streaming](/en/docs/agents-and-tools/tool-use/fine-grained-tool-streaming)
 * [Bash tool](/en/docs/agents-and-tools/tool-use/bash-tool)
 * [Code execution tool](/en/docs/agents-and-tools/tool-use/code-execution-tool)
 * [Computer use tool](/en/docs/agents-and-tools/tool-use/computer-use-tool)
 * [Text editor tool](/en/docs/agents-and-tools/tool-use/text-editor-tool)
 * [Web fetch tool](/en/docs/agents-and-tools/tool-use/web-fetch-tool)
 * [Web search tool](/en/docs/agents-and-tools/tool-use/web-search-tool)
 * [Memory tool](/en/docs/agents-and-tools/tool-use/memory-tool)
##### Agent Skills
 * [Overview](/en/docs/agents-and-tools/agent-skills/overview)
 * [Quickstart](/en/docs/agents-and-tools/agent-skills/quickstart)
 * [Best practices](/en/docs/agents-and-tools/agent-skills/best-practices)
##### Model Context Protocol (MCP)
 * [MCP connector](/en/docs/agents-and-tools/mcp-connector)
 * [Remote MCP servers](/en/docs/agents-and-tools/remote-mcp-servers)
##### Use cases
 * [Overview](/en/docs/about-claude/use-case-guides/overview)
 * [Ticket routing](/en/docs/about-claude/use-case-guides/ticket-routing)
 * [Customer support agent](/en/docs/about-claude/use-case-guides/customer-support-chat)
 * [Content moderation](/en/docs/about-claude/use-case-guides/content-moderation)
 * [Legal summarization](/en/docs/about-claude/use-case-guides/legal-summarization)
##### Prompt engineering
 * [Overview](/en/docs/build-with-claude/prompt-engineering/overview)
 * [Claude 4 best practices](/en/docs/build-with-claude/prompt-engineering/claude-4-best-practices)
 * [Prompt generator](/en/docs/build-with-claude/prompt-engineering/prompt-generator)
 * [Use prompt templates](/en/docs/build-with-claude/prompt-engineering/prompt-templates-and-variables)
 * [Prompt improver](/en/docs/build-with-claude/prompt-engineering/prompt-improver)
 * [Be clear and direct](/en/docs/build-with-claude/prompt-engineering/be-clear-and-direct)
 * [Use examples (multishot prompting)](/en/docs/build-with-claude/prompt-engineering/multishot-prompting)
 * [Let Claude think (CoT)](/en/docs/build-with-claude/prompt-engineering/chain-of-thought)
 * [Use XML tags](/en/docs/build-with-claude/prompt-engineering/use-xml-tags)
 * [Give Claude a role (system prompts)](/en/docs/build-with-claude/prompt-engineering/system-prompts)
 * [Prefill Claude's response](/en/docs/build-with-claude/prompt-engineering/prefill-claudes-response)
 * [Chain complex prompts](/en/docs/build-with-claude/prompt-engineering/chain-prompts)
 * [Long context tips](/en/docs/build-with-claude/prompt-engineering/long-context-tips)
 * [Extended thinking tips](/en/docs/build-with-claude/prompt-engineering/extended-thinking-tips)
##### Test & evaluate
 * [Define success criteria](/en/docs/test-and-evaluate/define-success)
 * [Develop test cases](/en/docs/test-and-evaluate/develop-tests)
 * [Using the Evaluation Tool](/en/docs/test-and-evaluate/eval-tool)
 * [Reducing latency](/en/docs/test-and-evaluate/strengthen-guardrails/reduce-latency)
##### Strengthen guardrails
 * [Reduce hallucinations](/en/docs/test-and-evaluate/strengthen-guardrails/reduce-hallucinations)
 * [Increase output consistency](/en/docs/test-and-evaluate/strengthen-guardrails/increase-consistency)
 * [Mitigate jailbreaks](/en/docs/test-and-evaluate/strengthen-guardrails/mitigate-jailbreaks)
 * [Streaming refusals](/en/docs/test-and-evaluate/strengthen-guardrails/handle-streaming-refusals)
 * [Reduce prompt leak](/en/docs/test-and-evaluate/strengthen-guardrails/reduce-prompt-leak)
 * [Keep Claude in character](/en/docs/test-and-evaluate/strengthen-guardrails/keep-claude-in-character)
On this page
 * [Streaming with SDKs](#streaming-with-sdks)
 * [Event types](#event-types)
 * [Ping events](#ping-events)
 * [Error events](#error-events)
 * [Other events](#other-events)
 * [Content block delta types](#content-block-delta-types)
 * [Text delta](#text-delta)
 * [Input JSON delta](#input-json-delta)
 * [Thinking delta](#thinking-delta)
 * [Full HTTP Stream response](#full-http-stream-response)
 * [Basic streaming request](#basic-streaming-request)
 * [Streaming request with tool use](#streaming-request-with-tool-use)
 * [Streaming request with extended thinking](#streaming-request-with-extended-thinking)
 * [Streaming request with web search tool use](#streaming-request-with-web-search-tool-use)
 * [Error recovery](#error-recovery)
 * [Error recovery best practices](#error-recovery-best-practices)
When creating a Message, you can set `"stream": true` to incrementally stream the response using [server-sent events](https://developer.mozilla.org/en-US/docs/Web/API/Server-sent%5Fevents/Using%5Fserver-sent%5Fevents) (SSE).
## 
[​](#streaming-with-sdks)
Streaming with SDKs
Our [Python](https://github.com/anthropics/anthropic-sdk-python) and [TypeScript](https://github.com/anthropics/anthropic-sdk-typescript) SDKs offer multiple ways of streaming. The Python SDK allows both sync and async streams. See the documentation in each SDK for details.
Python
TypeScript
Copy
```
import anthropic
client = anthropic.Anthropic()
with client.messages.stream(
 max_tokens=1024,
 messages=[{"role": "user", "content": "Hello"}],
 model="claude-sonnet-4-5",
) as stream:
 for text in stream.text_stream:
 print(text, end="", flush=True)
```
## 
[​](#event-types)
Event types
Each server-sent event includes a named event type and associated JSON data. Each event will use an SSE event name (e.g. `event: message_stop`), and include the matching event `type` in its data. Each stream uses the following event flow:
 1. `message_start`: contains a `Message` object with empty `content`.
 2. A series of content blocks, each of which have a `content_block_start`, one or more `content_block_delta` events, and a `content_block_stop` event. Each content block will have an `index` that corresponds to its index in the final Message `content` array.
 3. One or more `message_delta` events, indicating top-level changes to the final `Message` object.
 4. A final `message_stop` event.
The token counts shown in the `usage` field of the `message_delta` event are _cumulative_.
### 
[​](#ping-events)
Ping events
Event streams may also include any number of `ping` events.
### 
[​](#error-events)
Error events
We may occasionally send [errors](/en/api/errors) in the event stream. For example, during periods of high usage, you may receive an `overloaded_error`, which would normally correspond to an HTTP 529 in a non-streaming context:
Example error
Copy
```
event: error
data: {"type": "error", "error": {"type": "overloaded_error", "message": "Overloaded"}}
```
### 
[​](#other-events)
Other events
In accordance with our [versioning policy](/en/api/versioning), we may add new event types, and your code should handle unknown event types gracefully.
## 
[​](#content-block-delta-types)
Content block delta types
Each `content_block_delta` event contains a `delta` of a type that updates the `content` block at a given `index`.
### 
[​](#text-delta)
Text delta
A `text` content block delta looks like:
Text delta
Copy
```
event: content_block_delta
data: {"type": "content_block_delta","index": 0,"delta": {"type": "text_delta", "text": "ello frien"}}
```
### 
[​](#input-json-delta)
Input JSON delta
The deltas for `tool_use` content blocks correspond to updates for the `input` field of the block. To support maximum granularity, the deltas are _partial JSON strings_ , whereas the final `tool_use.input` is always an _object_. You can accumulate the string deltas and parse the JSON once you receive a `content_block_stop` event, by using a library like [Pydantic](https://docs.pydantic.dev/latest/concepts/json/#partial-json-parsing) to do partial JSON parsing, or by using our [SDKs](/en/api/client-sdks), which provide helpers to access parsed incremental values. A `tool_use` content block delta looks like:
Input JSON delta
Copy
```
event: content_block_delta
data: {"type": "content_block_delta","index": 1,"delta": {"type": "input_json_delta","partial_json": "{\"location\": \"San Fra"}}}
```
Note: Our current models only support emitting one complete key and value property from `input` at a time. As such, when using tools, there may be delays between streaming events while the model is working. Once an `input` key and value are accumulated, we emit them as multiple `content_block_delta` events with chunked partial json so that the format can automatically support finer granularity in future models.
### 
[​](#thinking-delta)
Thinking delta
When using [extended thinking](/en/docs/build-with-claude/extended-thinking#streaming-thinking) with streaming enabled, you’ll receive thinking content via `thinking_delta` events. These deltas correspond to the `thinking` field of the `thinking` content blocks. For thinking content, a special `signature_delta` event is sent just before the `content_block_stop` event. This signature is used to verify the integrity of the thinking block. A typical thinking delta looks like:
Thinking delta
Copy
```
event: content_block_delta
data: {"type": "content_block_delta", "index": 0, "delta": {"type": "thinking_delta", "thinking": "Let me solve this step by step:\n\n1. First break down 27 * 453"}}
```
The signature delta looks like:
Signature delta
Copy
```
event: content_block_delta
data: {"type": "content_block_delta", "index": 0, "delta": {"type": "signature_delta", "signature": "EqQBCgIYAhIM1gbcDa9GJwZA2b3hGgxBdjrkzLoky3dl1pkiMOYds..."}}
```
## 
[​](#full-http-stream-response)
Full HTTP Stream response
We strongly recommend that you use our [client SDKs](/en/api/client-sdks) when using streaming mode. However, if you are building a direct API integration, you will need to handle these events yourself. A stream response is comprised of:
 1. A `message_start` event
 2. Potentially multiple content blocks, each of which contains:
 * A `content_block_start` event
 * Potentially multiple `content_block_delta` events
 * A `content_block_stop` event
 3. A `message_delta` event
 4. A `message_stop` event
There may be `ping` events dispersed throughout the response as well. See [Event types](#event-types) for more details on the format.
### 
[​](#basic-streaming-request)
Basic streaming request
Shell
Python
Copy
```
curl https://api.anthropic.com/v1/messages \
 --header "anthropic-version: 2023-06-01" \
 --header "content-type: application/json" \
 --header "x-api-key: $ANTHROPIC_API_KEY" \
 --data \
'{
 "model": "claude-sonnet-4-5",
 "messages": [{"role": "user", "content": "Hello"}],
 "max_tokens": 256,
 "stream": true
}'
```
Response
Copy
```
event: message_start
data: {"type": "message_start", "message": {"id": "msg_1nZdL29xx5MUA1yADyHTEsnR8uuvGzszyY", "type": "message", "role": "assistant", "content": [], "model": "claude-sonnet-4-5-20250929", "stop_reason": null, "stop_sequence": null, "usage": {"input_tokens": 25, "output_tokens": 1}}}
event: content_block_start
data: {"type": "content_block_start", "index": 0, "content_block": {"type": "text", "text": ""}}
event: ping
data: {"type": "ping"}
event: content_block_delta
data: {"type": "content_block_delta", "index": 0, "delta": {"type": "text_delta", "text": "Hello"}}
event: content_block_delta
data: {"type": "content_block_delta", "index": 0, "delta": {"type": "text_delta", "text": "!"}}
event: content_block_stop
data: {"type": "content_block_stop", "index": 0}
event: message_delta
data: {"type": "message_delta", "delta": {"stop_reason": "end_turn", "stop_sequence":null}, "usage": {"output_tokens": 15}}
event: message_stop
data: {"type": "message_stop"}
```
### 
[​](#streaming-request-with-tool-use)
Streaming request with tool use
Tool use now supports fine-grained streaming for parameter values as a beta feature. For more details, see [Fine-grained tool streaming](/en/docs/agents-and-tools/tool-use/fine-grained-tool-streaming).
In this request, we ask Claude to use a tool to tell us the weather.
Shell
Python
Copy
```
 curl https://api.anthropic.com/v1/messages \
 -H "content-type: application/json" \
 -H "x-api-key: $ANTHROPIC_API_KEY" \
 -H "anthropic-version: 2023-06-01" \
 -d '{
 "model": "claude-sonnet-4-5",
 "max_tokens": 1024,
 "tools": [
 {
 "name": "get_weather",
 "description": "Get the current weather in a given location",
 "input_schema": {
 "type": "object",
 "properties": {
 "location": {
 "type": "string",
 "description": "The city and state, e.g. San Francisco, CA"
 }
 },
 "required": ["location"]
 }
 }
 ],
 "tool_choice": {"type": "any"},
 "messages": [
 {
 "role": "user",
 "content": "What is the weather like in San Francisco?"
 }
 ],
 "stream": true
 }'
```
Response
Copy
```
event: message_start
data: {"type":"message_start","message":{"id":"msg_014p7gG3wDgGV9EUtLvnow3U","type":"message","role":"assistant","model":"claude-sonnet-4-5-20250929","stop_sequence":null,"usage":{"input_tokens":472,"output_tokens":2},"content":[],"stop_reason":null}}
event: content_block_start
data: {"type":"content_block_start","index":0,"content_block":{"type":"text","text":""}}
event: ping
data: {"type": "ping"}
event: content_block_delta
data: {"type":"content_block_delta","index":0,"delta":{"type":"text_delta","text":"Okay"}}
event: content_block_delta
data: {"type":"content_block_delta","index":0,"delta":{"type":"text_delta","text":","}}
event: content_block_delta
data: {"type":"content_block_delta","index":0,"delta":{"type":"text_delta","text":" let"}}
event: content_block_delta
data: {"type":"content_block_delta","index":0,"delta":{"type":"text_delta","text":"'s"}}
event: content_block_delta
data: {"type":"content_block_delta","index":0,"delta":{"type":"text_delta","text":" check"}}
event: content_block_delta
data: {"type":"content_block_delta","index":0,"delta":{"type":"text_delta","text":" the"}}
event: content_block_delta
data: {"type":"content_block_delta","index":0,"delta":{"type":"text_delta","text":" weather"}}
event: content_block_delta
data: {"type":"content_block_delta","index":0,"delta":{"type":"text_delta","text":" for"}}
event: content_block_delta
data: {"type":"content_block_delta","index":0,"delta":{"type":"text_delta","text":" San"}}
event: content_block_delta
data: {"type":"content_block_delta","index":0,"delta":{"type":"text_delta","text":" Francisco"}}
event: content_block_delta
data: {"type":"content_block_delta","index":0,"delta":{"type":"text_delta","text":","}}
event: content_block_delta
data: {"type":"content_block_delta","index":0,"delta":{"type":"text_delta","text":" CA"}}
event: content_block_delta
data: {"type":"content_block_delta","index":0,"delta":{"type":"text_delta","text":":"}}
event: content_block_stop
data: {"type":"content_block_stop","index":0}
event: content_block_start
data: {"type":"content_block_start","index":1,"content_block":{"type":"tool_use","id":"toolu_01T1x1fJ34qAmk2tNTrN7Up6","name":"get_weather","input":{}}}
event: content_block_delta
data: {"type":"content_block_delta","index":1,"delta":{"type":"input_json_delta","partial_json":""}}
event: content_block_delta
data: {"type":"content_block_delta","index":1,"delta":{"type":"input_json_delta","partial_json":"{\"location\":"}}
event: content_block_delta
data: {"type":"content_block_delta","index":1,"delta":{"type":"input_json_delta","partial_json":" \"San"}}
event: content_block_delta
data: {"type":"content_block_delta","index":1,"delta":{"type":"input_json_delta","partial_json":" Francisc"}}
event: content_block_delta
data: {"type":"content_block_delta","index":1,"delta":{"type":"input_json_delta","partial_json":"o,"}}
event: content_block_delta
data: {"type":"content_block_delta","index":1,"delta":{"type":"input_json_delta","partial_json":" CA\""}}
event: content_block_delta
data: {"type":"content_block_delta","index":1,"delta":{"type":"input_json_delta","partial_json":", "}}
event: content_block_delta
data: {"type":"content_block_delta","index":1,"delta":{"type":"input_json_delta","partial_json":"\"unit\": \"fah"}}
event: content_block_delta
data: {"type":"content_block_delta","index":1,"delta":{"type":"input_json_delta","partial_json":"renheit\"}"}}
event: content_block_stop
data: {"type":"content_block_stop","index":1}
event: message_delta
data: {"type":"message_delta","delta":{"stop_reason":"tool_use","stop_sequence":null},"usage":{"output_tokens":89}}
event: message_stop
data: {"type":"message_stop"}
```
### 
[​](#streaming-request-with-extended-thinking)
Streaming request with extended thinking
In this request, we enable extended thinking with streaming to see Claude’s step-by-step reasoning.
Shell
Python
Copy
```
curl https://api.anthropic.com/v1/messages \
 --header "x-api-key: $ANTHROPIC_API_KEY" \
 --header "anthropic-version: 2023-06-01" \
 --header "content-type: application/json" \
 --data \
'{
 "model": "claude-sonnet-4-5",
 "max_tokens": 20000,
 "stream": true,
 "thinking": {
 "type": "enabled",
 "budget_tokens": 16000
 },
 "messages": [
 {
 "role": "user",
 "content": "What is 27 * 453?"
 }
 ]
}'
```
Response
Copy
```
event: message_start
data: {"type": "message_start", "message": {"id": "msg_01...", "type": "message", "role": "assistant", "content": [], "model": "claude-sonnet-4-5-20250929", "stop_reason": null, "stop_sequence": null}}
event: content_block_start
data: {"type": "content_block_start", "index": 0, "content_block": {"type": "thinking", "thinking": ""}}
event: content_block_delta
data: {"type": "content_block_delta", "index": 0, "delta": {"type": "thinking_delta", "thinking": "Let me solve this step by step:\n\n1. First break down 27 * 453"}}
event: content_block_delta
data: {"type": "content_block_delta", "index": 0, "delta": {"type": "thinking_delta", "thinking": "\n2. 453 = 400 + 50 + 3"}}
event: content_block_delta
data: {"type": "content_block_delta", "index": 0, "delta": {"type": "thinking_delta", "thinking": "\n3. 27 * 400 = 10,800"}}
event: content_block_delta
data: {"type": "content_block_delta", "index": 0, "delta": {"type": "thinking_delta", "thinking": "\n4. 27 * 50 = 1,350"}}
event: content_block_delta
data: {"type": "content_block_delta", "index": 0, "delta": {"type": "thinking_delta", "thinking": "\n5. 27 * 3 = 81"}}
event: content_block_delta
data: {"type": "content_block_delta", "index": 0, "delta": {"type": "thinking_delta", "thinking": "\n6. 10,800 + 1,350 + 81 = 12,231"}}
event: content_block_delta
data: {"type": "content_block_delta", "index": 0, "delta": {"type": "signature_delta", "signature": "EqQBCgIYAhIM1gbcDa9GJwZA2b3hGgxBdjrkzLoky3dl1pkiMOYds..."}}
event: content_block_stop
data: {"type": "content_block_stop", "index": 0}
event: content_block_start
data: {"type": "content_block_start", "index": 1, "content_block": {"type": "text", "text": ""}}
event: content_block_delta
data: {"type": "content_block_delta", "index": 1, "delta": {"type": "text_delta", "text": "27 * 453 = 12,231"}}
event: content_block_stop
data: {"type": "content_block_stop", "index": 1}
event: message_delta
data: {"type": "message_delta", "delta": {"stop_reason": "end_turn", "stop_sequence": null}}
event: message_stop
data: {"type": "message_stop"}
```
### 
[​](#streaming-request-with-web-search-tool-use)
Streaming request with web search tool use
In this request, we ask Claude to search the web for current weather information.
Shell
Python
Copy
```
curl https://api.anthropic.com/v1/messages \
 --header "x-api-key: $ANTHROPIC_API_KEY" \
 --header "anthropic-version: 2023-06-01" \
 --header "content-type: application/json" \
 --data \
'{
 "model": "claude-sonnet-4-5",
 "max_tokens": 1024,
 "stream": true,
 "tools": [
 {
 "type": "web_search_20250305",
 "name": "web_search",
 "max_uses": 5
 }
 ],
 "messages": [
 {
 "role": "user",
 "content": "What is the weather like in New York City today?"
 }
 ]
}'
```
Response
Copy
```
event: message_start
data: {"type":"message_start","message":{"id":"msg_01G...","type":"message","role":"assistant","model":"claude-sonnet-4-5-20250929","content":[],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":2679,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":3}}}
event: content_block_start
data: {"type":"content_block_start","index":0,"content_block":{"type":"text","text":""}}
event: content_block_delta
data: {"type":"content_block_delta","index":0,"delta":{"type":"text_delta","text":"I'll check"}}
event: content_block_delta
data: {"type":"content_block_delta","index":0,"delta":{"type":"text_delta","text":" the current weather in New York City for you"}}
event: ping
data: {"type": "ping"}
event: content_block_delta
data: {"type":"content_block_delta","index":0,"delta":{"type":"text_delta","text":"."}}
event: content_block_stop
data: {"type":"content_block_stop","index":0}
event: content_block_start
data: {"type":"content_block_start","index":1,"content_block":{"type":"server_tool_use","id":"srvtoolu_014hJH82Qum7Td6UV8gDXThB","name":"web_search","input":{}}}
event: content_block_delta
data: {"type":"content_block_delta","index":1,"delta":{"type":"input_json_delta","partial_json":""}}
event: content_block_delta
data: {"type":"content_block_delta","index":1,"delta":{"type":"input_json_delta","partial_json":"{\"query"}}
event: content_block_delta
data: {"type":"content_block_delta","index":1,"delta":{"type":"input_json_delta","partial_json":"\":"}}
event: content_block_delta
data: {"type":"content_block_delta","index":1,"delta":{"type":"input_json_delta","partial_json":" \"weather"}}
event: content_block_delta
data: {"type":"content_block_delta","index":1,"delta":{"type":"input_json_delta","partial_json":" NY"}}
event: content_block_delta
data: {"type":"content_block_delta","index":1,"delta":{"type":"input_json_delta","partial_json":"C to"}}
event: content_block_delta
data: {"type":"content_block_delta","index":1,"delta":{"type":"input_json_delta","partial_json":"day\"}"}}
event: content_block_stop
data: {"type":"content_block_stop","index":1 }
event: content_block_start
data: {"type":"content_block_start","index":2,"content_block":{"type":"web_search_tool_result","tool_use_id":"srvtoolu_014hJH82Qum7Td6UV8gDXThB","content":[{"type":"web_search_result","title":"Weather in New York City in May 2025 (New York) - detailed Weather Forecast for a month","url":"https://world-weather.info/forecast/usa/new_york/may-2025/","encrypted_content":"Ev0DCioIAxgCIiQ3NmU4ZmI4OC1k...","page_age":null},...]}}
event: content_block_stop
data: {"type":"content_block_stop","index":2}
event: content_block_start
data: {"type":"content_block_start","index":3,"content_block":{"type":"text","text":""}}
event: content_block_delta
data: {"type":"content_block_delta","index":3,"delta":{"type":"text_delta","text":"Here's the current weather information for New York"}}
event: content_block_delta
data: {"type":"content_block_delta","index":3,"delta":{"type":"text_delta","text":" City:\n\n# Weather"}}
event: content_block_delta
data: {"type":"content_block_delta","index":3,"delta":{"type":"text_delta","text":" in New York City"}}
event: content_block_delta
data: {"type":"content_block_delta","index":3,"delta":{"type":"text_delta","text":"\n\n"}}
...
event: content_block_stop
data: {"type":"content_block_stop","index":17}
event: message_delta
data: {"type":"message_delta","delta":{"stop_reason":"end_turn","stop_sequence":null},"usage":{"input_tokens":10682,"cache_creation_input_tokens":0,"cache_read_input_tokens":0,"output_tokens":510,"server_tool_use":{"web_search_requests":1}}}
event: message_stop
data: {"type":"message_stop"}
```
## 
[​](#error-recovery)
Error recovery
When a streaming request is interrupted due to network issues, timeouts, or other errors, you can recover by resuming from where the stream was interrupted. This approach saves you from re-processing the entire response. The basic recovery strategy involves:
 1. **Capture the partial response** : Save all content that was successfully received before the error occurred
 2. **Construct a continuation request** : Create a new API request that includes the partial assistant response as the beginning of a new assistant message
 3. **Resume streaming** : Continue receiving the rest of the response from where it was interrupted
### 
[​](#error-recovery-best-practices)
Error recovery best practices
 1. **Use SDK features** : Leverage the SDK’s built-in message accumulation and error handling capabilities
 2. **Handle content types** : Be aware that messages can contain multiple content blocks (`text`, `tool_use`, `thinking`). Tool use and extended thinking blocks cannot be partially recovered. You can resume streaming from the most recent text block.
Was this page helpful?
YesNo
[Extended thinking](/en/docs/build-with-claude/extended-thinking)[Batch processing](/en/docs/build-with-claude/batch-processing)
Assistant
Responses are generated using AI and may contain mistakes.