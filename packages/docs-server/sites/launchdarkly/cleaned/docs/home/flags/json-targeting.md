`/`
[Product docs](/docs/home)[Guides](/docs/guides)[SDKs](/docs/sdk)[Integrations](/docs/integrations)[API docs](/docs/api)[Tutorials](/docs/tutorials)[Flagship Blog](/docs/blog)
 * Getting started
 * [Overview](/docs/home)
 * [Launch Insights](/docs/home/getting-started/launch-insights)
 * [LaunchDarkly architecture](/docs/home/getting-started/architecture)
 * [LaunchDarkly vocabulary](/docs/home/getting-started/vocabulary)
 * Feature flags and AI Configs
 * [Create flags](/docs/home/flags/create)
 * [Target with flags](/docs/home/flags/target)
 * [Flag templates](/docs/home/flags/templates)
 * [Manage flags](/docs/home/flags/manage)
 * [Code references](/docs/home/flags/code-references)
 * [AI Configs](/docs/home/ai-configs)
 * [Contexts](/docs/home/flags/contexts)
 * [Segments](/docs/home/flags/segments)
 * Releases
 * [Releasing features with LaunchDarkly](/docs/home/releases/releasing)
 * [Release policies](/docs/home/releases/release-policies)
 * [Percentage rollouts](/docs/home/releases/percentage-rollouts)
 * [Progressive rollouts](/docs/home/releases/progressive-rollouts)
 * [Guarded rollouts](/docs/home/releases/guarded-rollouts)
 * [Feature monitoring](/docs/home/releases/feature-monitoring)
 * [Release pipelines](/docs/home/releases/release-pipelines)
 * [Engineering insights](/docs/home/releases/eng-insights)
 * [Release management tools](/docs/home/releases/release-management)
 * [Applications and app versions](/docs/home/releases/apps-and-app-versions)
 * [Change history](/docs/home/releases/change-history)
 * Observability
 * [Observability](/docs/home/observability)
 * [Session replay](/docs/home/observability/session-replay)
 * [Error monitoring](/docs/home/observability/errors)
 * [Logs](/docs/home/observability/logs)
 * [Traces](/docs/home/observability/traces)
 * [LLM observability](/docs/home/observability/llm-observability)
 * [Alerts](/docs/home/observability/alerts)
 * [Dashboards](/docs/home/observability/dashboards)
 * [Search specification](/docs/home/observability/search)
 * [Observability settings](/docs/home/observability/settings)
 * [Vega](/docs/home/observability/vega)
 * Product analytics
 * [Product analytics](/docs/home/product-analytics)
 * [Setting up product analytics](/docs/home/product-analytics/setup)
 * [Using product analytics charts](/docs/home/product-analytics/chart)
 * Experimentation
 * [Experimentation](/docs/home/experimentation)
 * [Creating experiments](/docs/home/experimentation/create)
 * [Managing experiments](/docs/home/experimentation/manage)
 * [Analyzing experiments](/docs/home/experimentation/analyze)
 * [Experimentation and metric events](/docs/home/experimentation/events)
 * [Multi-armed bandits](/docs/home/multi-armed-bandits)
 * [Holdouts](/docs/home/holdouts)
 * Metrics
 * [Metrics](/docs/home/metrics)
 * [Metric groups](/docs/home/metrics/metric-groups)
 * [Autogenerated metrics](/docs/home/metrics/autogen-metrics)
 * [Metric impact](/docs/home/metrics/metric-impact)
 * [Metric events](/docs/home/metrics/metric-events)
 * Warehouse native
 * [Warehouse native Experimentation](/docs/home/warehouse-native)
 * [Warehouse native metrics](/docs/home/warehouse-native/metrics)
 * [Creating warehouse native experiments](/docs/home/warehouse-native/creating)
 * Infrastructure
 * [Connect apps and services to LaunchDarkly](/docs/home/infrastructure/apps)
 * [LaunchDarkly in China and Pakistan](/docs/home/infrastructure/china)
 * [LaunchDarkly in the European Union (EU)](/docs/home/infrastructure/eu)
 * [LaunchDarkly in federal environments](/docs/home/infrastructure/federal)
 * [Public IP list](/docs/home/infrastructure/ip-list)
 * Your account
 * [Projects](/docs/home/account/project)
 * [Views](/docs/home/account/views)
 * [Environments](/docs/home/account/environment)
 * [Tags](/docs/home/account/tags)
 * [Teams](/docs/home/account/teams)
 * [Members](/docs/home/account/members)
 * [Roles](/docs/home/account/roles)
 * [Account security](/docs/home/account/secure)
 * [Billing and usage](/docs/home/account/billing)
 * [Changelog](/docs/home/changelog)
[Sign in](/)[Sign up](https://app.launchdarkly.com/signup)
On this page
 * [Overview](#overview)
 * [View JSON targeting rules](#view-json-targeting-rules)
 * [Basic JSON structure](#basic-json-structure)
 * [Variation IDs](#variation-ids)
 * [Flag on/off status](#flag-onoff-status)
 * [Off variation](#off-variation)
 * [Default rule or variation](#default-rule-or-variation)
 * [Prerequisites](#prerequisites)
 * [Individual targeting](#individual-targeting)
 * [Target multiple context kinds](#target-multiple-context-kinds)
 * [Target different variations](#target-different-variations)
 * [Segment targeting](#segment-targeting)
 * [Mobile targeting](#mobile-targeting)
 * [Custom targeting rules](#custom-targeting-rules)
 * [Rollouts](#rollouts)
 * [Manual percentage rollout](#manual-percentage-rollout)
 * [Progressive rollout](#progressive-rollout)
 * [Guarded rollout](#guarded-rollout)
 * [Example JSON targeting](#example-json-targeting)
## Overview
This topic explains how to create and edit flag targeting rules using JSON.
Editing flag rules using JSON follows the same model as the JSON response from the [Get feature flag](/docs/api/feature-flags/get-feature-flag) endpoint in the REST API.
## View JSON targeting rules
To view a flag’s targeting rules in JSON, navigate to the **Targeting** tab and click the 
![The JSON targeting option on a flag's Targeting tab.](https://files.buildwithfern.com/https://launchdarkly.docs.buildwithfern.com/docs/9282649b2bd49393e8792b0b9f134b3f868c9003e1a7c81af9df7daa0f86f126/assets/images/__toPlaywright_newIA/targeting-tab-json.png)
The JSON targeting option on a flag's Targeting tab.
## Basic JSON structure
Below is an example of the basic JSON structure for a boolean feature flag:
Boolean feature flag
```
1
| {
---|--- 
2
| "on": false, // the flag is toggled off
3
| "prerequisites": [], // the flag has no prerequisites
4
| "contextTargets": [], // the flag has no individual targeting rules
5
| "rules": [], // the flag has no custom targeting rules
6
| "fallthrough": {
7
| "variation": 0 // the fallthrough, or default, variation is true
8
| },
9
| "offVariation": 1 // the off variation is false
10
| }
```
This example flag:
 * is toggled off
 * has no prerequisites
 * has no targeting rules besides the [default rule](/docs/home/flags/default-rule)
 * has true (`0`) as the default rule
 * has false (`1`) as the [off variation](/docs/home/flags/off-variation)
### Variation IDs
For boolean flags, the ID of the `true` variation is always `0`, and the ID of the `false` variation is always `1`.
For multivariate flags, the ID of the first variation is `0`, the ID of the second variation is `1`, and so on.
## Flag on/off status
To toggle a flag on or off, set `on` to `true` or `false`.
Here is what a flag toggle looks like in the user interface (UI):
![The flag toggle on the targeting tab.](https://files.buildwithfern.com/https://launchdarkly.docs.buildwithfern.com/docs/96e559ef82de2051ef95681d5d2f5b6d24e81153c1c07a9cb2ecdff2f77937f6/assets/images/__toPlaywright_newIA/flag-targeting-toggle-new.png)
The flag toggle on the targeting tab.
Here is an example of how to toggle a flag `on`:
Flag on/off status
```
1
| {
---|--- 
2
| "on": true
3
| }
```
To learn about toggling flags on and off in the UI, read [Turning flags on and off](/docs/home/flags/toggle).
## Off variation
The off variation is the variation served to all contexts when a flag is off.
Here is an example of how to set the off variation:
Off variation
```
1
| {
---|--- 
2
| "offVariation": 1 // the off variation is false
3
| }
```
To learn how to set the off variation in the UI, read [The off variation](/docs/home/flags/off-variation).
## Default rule or variation
The [default](/docs/home/flags/default-rule), or fallthrough, rule is the rollout or variation that a flag serves when a context doesn’t match any other targeting rules on the flag.
Here is what a default rule looks like in the UI:
![A flag's default rule.](https://files.buildwithfern.com/https://launchdarkly.docs.buildwithfern.com/docs/7333de9ee2e09b68541fc5e1d6c4975e307a08e424cd5b2502c3618a22226d6f/assets/images/auto/flag-rules-default.auto.png)
A flag's default rule.
To set a default variation, use `fallthrough` and set `variation` to the ID of the flag variation you want to use as the default variation.
Here is an example of setting the default variation on a boolean flag:
Default variation
```
1
| {
---|--- 
2
| "fallthrough": {
3
| "variation": 1 // the default variation is false
4
| }
5
| }
```
You can also set a rollout, instead of a single variation, as the default rule. To learn how, read [Rollouts](/docs/home/flags/json-targeting#rollouts).
To learn how to set the default rule in the UI, read [The default rule](/docs/home/flags/default-rule).
## Prerequisites
To set a prerequisite, use `prerequisites` with the following key/value pairs:
 * `key`: the prerequisite flag key.
 * `variation`: the ID of the prerequisite flag’s variation you want to require.
Here is what a prerequisite rule looks like in the UI:
![The "Prerequisites" section of the dependent flag with a prerequisite flag added.](https://files.buildwithfern.com/https://launchdarkly.docs.buildwithfern.com/docs/f38e00fc6d4ffc675df870fe412bce8df0228ac7dcc02d1fcfa120eb54628572/assets/images/auto/targeting-prerequisite-section-new.auto.png)
The "Prerequisites" section of the dependent flag with a prerequisite flag added.
Here is an example prerequisite rule requiring the prerequisite variation for the flag `alt-sort-order` to be `true`:
Prerequisites
```
1
| {
---|--- 
2
| "prerequisites": [
3
| {
4
| "key": "alt-sort-order", // the prerequisite flag key
5
| "variation": 0 // the prerequisite flag variation must be true
6
| }
7
| ]
8
| }
```
In the above example, if the prerequisite flag is `on: true`, and a context encountering this flag is receiving the true (`0`) variation of the prerequisite flag, then the context is subject to this flag’s targeting rules.
If the prerequisite flag is `on: false`, or the context is receiving a variation other than true (`0`), then the context will receive this flag’s `offVariation` of false (`1`).
To learn how to use prerequisite flags in the UI, read [Flag prerequisites](/docs/home/flags/prereqs).
## Individual targeting
Individual targeting lets you serve chosen variations to specific contexts.
Here is what an individual targeting rule looks like in the UI:
![A flag with a user context individually targeted.](https://files.buildwithfern.com/https://launchdarkly.docs.buildwithfern.com/docs/3ccbc268e1ceaaf997253520333319e758e873d2becf68eae40276440c17ee1e/assets/images/__toPlaywright_newIA/flag-targeting-individual-contexts-new.png)
A flag with a user context individually targeted.
To individually target a context, use `contextTargets` with the following key/value pairs:
 * `variation`: the ID of the variation you want to serve.
 * `values`: the context keys you want to target.
 * `contextKind`: the context kind of the contexts you want to target.
Here is an example individual targeting rule for a user context:
Individual targeting
```
1
| {
---|--- 
2
| "contextTargets": [{
3
| "variation": 0, // this individual targeting rule serves the true variation
4
| "values": [
5
| "user-key-123abc" // the context key
6
| ],
7
| "contextKind": "user" // the context kind is user
8
| }]
9
| }
```
To learn how to target individual contexts in the UI, read [Individual targeting](/docs/home/flags/individual-targeting).
### Target multiple context kinds
You can use multiple rules if you need to target multiple context kinds.
This example flag targets both user and organization contexts:
Individual targeting multiple context kinds
```
1
| {
---|--- 
2
| "contextTargets": [{
3
| "variation": 0, // this individual targeting rule serves the true variation
4
| "values": [
5
| "user-key-123abc", // the first user context key
6
| "user-key-456def" // the second user context key
7
| ],
8
| "contextKind": "user" // the context kind is user for both contexts
9
| },
10
| {
11
| "variation": 0, // this individual targeting rule serves the true variation
12
| "values": [
13
| "org-key-123abc", // the first organization context key
14
| "org-key-456def" // the second organization context key
15
| ],
16
| "contextKind": "organization" // the context kind is organization for both contexts
17
| }]
18
| }
```
### Target different variations
You can use multiple rules if some individually targeted contexts should receive different variations than others.
This example flag serves true to some contexts and false to others:
Individual targeting multiple context kinds
```
1
| {
---|--- 
2
| "contextTargets": [{
3
| "variation": 0, // this individual targeting rule serves the true variation
4
| "values": [
5
| "user-key-123abc", // the first user context key
6
| 
7
| ],
8
| "contextKind": "user" // the context kind is user
9
| },
10
| {
11
| "variation": 1, // this individual targeting rule serves the false variation
12
| "values": [
13
| "user-key-456def" // the second user context key
14
| ],
15
| "contextKind": "user" // the context kind is user
16
| }]
17
| }
```
## Segment targeting
Segment targeting rules let you serve chosen variations to specific LaunchDarkly [segments](/docs/home/flags/segments).
Here is what a segment targeting rule looks like in the UI:
![A targeting rule for segments.](https://files.buildwithfern.com/https://launchdarkly.docs.buildwithfern.com/docs/85d8a06d1902751b304eb1b0f9505cd16fe370507bbb15235c51acd716740138/assets/images/auto/guide-targeting-tab-segments-rule.auto.png)
A targeting rule for segments.
To target a segment, use `clauses` with the following key/value pairs:
 * `attribute`: `segmentMatch` or `not-SegmentMatch`, depending on whether or not you want the rule to target contexts in the chosen segment, or not in the chosen segment
 * `op`: `segmentMatch`
 * `negate`: set to `false` if you set `attribute` to `segmentMatch`. Set to `true` if you set `attribute` to `not-segmentMatch`.
 * `values`: the segment keys you want to target in the rule
Segment targeting
```
1
| {
---|--- 
2
| "rules": [
3
| {
4
| "clauses": [
5
| {
6
| "attribute": "segmentMatch", // this rule will target contexts in the segment
7
| "contextKind": "", // leave the contextKind blank for segment targeting
8
| "negate": false, // the attribute is segmentMatch, so this is set to false
9
| "op": "segmentMatch", // op is always segmentMatch
10
| "values": [
11
| "internal-testers", // the segment key of the segment you want to target
12
| ]
13
| }
14
| ],
15
| "description": "Include internal testers", // the rule description, optional
16
| "variation": 0 // this rule is serving true
17
| }
18
| ]
19
| }
```
After you save a segment targeting rule, LaunchDarkly automatically assigns a read-only `_id` value to each rule clause. You do not need to supply this ID yourself, and you cannot edit the ID after it has been assigned.
To learn how to build segment targeting rules in the UI, read [Targeting segments](/docs/home/flags/segment-targeting).
## Mobile targeting
Mobile targeting rules let you control which mobile apps and devices receive a variation of a feature flag.
Here is an example of a mobile targeting rule in the UI:
![A targeting rule for mobile apps.](https://files.buildwithfern.com/https://launchdarkly.docs.buildwithfern.com/docs/daea32ca7fdb6586686febf96c117563945c95a982b045e595815d7ea64cdbc1/assets/images/auto/targeting-tab-mobile-rule-version-support-status.auto.png)
A targeting rule for mobile apps.
To target mobile devices, use `rules` with the following key/value pairs:
 * `description` (optional): the description of the rule.
 * `variation`: the ID of the variation you want to serve.
 * `clauses` with the following key/value pairs:
 * `contextKind`: either `ld_application` or `ld_device`, depending on if you want to target mobile applications or mobile devices in this rule.
 * `attribute`: the [context attribute](/docs/home/flags/target-rules#attributes) you want to use in the rule.
 * `op`: the operators available depend on your context kind and attribute:
 * if your `contextKind` is `ld_application`, and your `attribute` is `version support status`, then `applicationVersionSupported` is the only available operator.
 * otherwise, use the standard [operator](/docs/home/flags/target-rules#operators) you want to use in the rule.
 * `negate`: set to `true` to use the inverse of the operator. For example, if `op` is set to `in`, use `"negate": true` to use “is not in” as the operator. Otherwise, set to `false`.
 * `values`: the [attribute values](/docs/home/flags/context-attributes) you want to use in the rule.
Mobile targeting
```
1
| {
---|--- 
2
| "rules": [
3
| {
4
| "description": "Support for versions 12.5 and higher", // the rule description, optional
5
| "variation": 0, // this mobile rule serves the true variation
6
| "clauses": [
7
| {"contextKind": "ld_application",
8
| "attribute": "version_support_status",
9
| "op": "applicationVersionSupported",
10
| "negate": false,
11
| "attribute": "version_support_status", // the application attribute is "version support status"
12
| "contextKind": "device", // the context kind is device
13
| "negate": false,
14
| "op": "applicationVersionSupported", // the operator is "is supported for"
15
| "values": [
16
| "12.5" // the application version number is 12.5
17
| ]
18
| }
19
| ]
20
| }
21
| ]
22
| }
```
After you save a mobile targeting rule, LaunchDarkly automatically assigns a read-only `_id` value to each rule clause. You do not need to supply this ID yourself, and you cannot edit the ID after it has been assigned.
To learn how to build mobile targeting rules in the UI, read [Mobile targeting](/docs/home/flags/mobile-targeting).
## Custom targeting rules
Custom targeting rules let you target contexts based on their context kind and attributes.
Here is an example of a custom targeting rule in the UI:
![Two custom targeting rules.](https://files.buildwithfern.com/https://launchdarkly.docs.buildwithfern.com/docs/b5320804f54b1ff1ca16bd8dbf57474b7dd701406b33528e0265e20cc1febd7e/assets/images/auto/flag-targeting-multiple-groups.auto.png)
Two custom targeting rules.
To target custom context kinds and attributes, use `rules` with the following key/value pairs:
 * `description` (optional): the description of the rule.
 * `variation`: the ID of the variation you want to serve.
 * `values`: the context keys you want to target.
 * `clauses`, with the following key/value pairs:
 * `contextKind`: the context kind of the contexts you want to target.
 * `attribute`: the [context attribute](/docs/home/flags/target-rules#attributes) you want to use in the rule.
 * `op`: the standard [operator](/docs/home/flags/target-rules#operators) you want to use in the rule.
 * `negate`: leave set to `true`, or set to `false` to use the inverse of the operator. For example, if `op` is set to `in`, use `"negate": true` to use “is not in” as the operator.
 * `values`: the [attribute values](/docs/home/flags/context-attributes) you want to use in the rule.
 * `trackEvents` (optional): `true` or `false` depending on whether or not you want to send [feature events](/docs/home/releases/live-events#feature-events) to LaunchDarkly.
Here is an example custom targeting rule that targets customers with an email address that ends in `.edu`:
Custom targeting rule for students
```
1
| {
---|--- 
2
| "rules": [{
3
| "description": "Student customers", // the rule description, optional
4
| "variation": 0, // this custom rule serves the true variation
5
| "clauses": [{
6
| "contextKind": "user", // the context kind is user
7
| "attribute": "email", // the context attribute is "email"
8
| "op": "endsWith", // the rule operator is "ends with"
9
| "negate": false, // the operator is not negated
10
| "values": [
11
| ".edu" // the attribute value
12
| ]
13
| }],
14
| "trackEvents": false // the flag is not sending feature events to LaunchDarkly, optional
15
| }]
16
| }
```
Here is an example targeting rule that targets accounts for an Early Access Program (EAP):
Custom targeting rule for an EAP
```
1
| {
---|--- 
2
| "rules": [{
3
| "description": "Early access accounts", // the rule description, optional
4
| "variation": 0, // this custom rule serves the true variation
5
| "clauses": [{
6
| "contextKind": "account", // the context kind is account
7
| "attribute": "eap-account", // the context attribute is "eap-account"
8
| "op": "in", // the rule operator is "is one of"
9
| "negate": false, // the operator is not negated
10
| "values": [
11
| "true" // the attribute value is true
12
| ]
13
| }],
14
| "trackEvents": true // the flag is sending feature events to LaunchDarkly, optional
15
| }]
16
| }
```
After you save a custom targeting rule, LaunchDarkly automatically assigns a read-only `_id` value to each rule clause. You do not need to supply this ID yourself, and you cannot edit the ID after it has been assigned.
To learn how to build custom targeting rules in the UI, read [Custom rules](/docs/home/flags/custom-rules).
## Rollouts
When you create a custom rule or default rule, you can choose to serve a rollout instead of a single variation.
There are three kinds of rollouts:
 * Manual percentage rollout
 * Progressive rollout
 * Guarded rollout
### Manual percentage rollout
Percentage rollouts let you roll out your feature to a small percentage of contexts and, as you become more confident your feature is working as intended, manually increase the percentage over time.
Here is what a percentage rollout looks like in the UI:
![A 50/50 percentage rollout for a boolean flag.](https://files.buildwithfern.com/https://launchdarkly.docs.buildwithfern.com/docs/616616422c9064b4adedc6d3a480512166eaf95f2ae75a4adb236f9a43479179/assets/images/auto/flag-rules-percentage-fifty.auto.png)
A 50/50 percentage rollout for a boolean flag.
To create a manual percentage rollout, use `percentageRolloutConfig` with the following key/value pairs:
 * `contextKind` (optional): the context kind you want to roll out by. Defaults to your [default context kind](/docs/home/flags/context-kinds#built-in-context-kinds).
 * `bucketBy` (optional): the attribute value you want to roll out by. Defaults to `key`.
 * `variations`, with the following key/value pairs:
 * `variation`: the ID of the variation you want to serve.
 * `weight`: the percentage of contexts you want to include in that variation. Include three decimal places in the percentage, with no `.` or `,`. Do not include leading `0`s. For example:
 * to include 5.5% of contexts in a variation, set the `weight` to `5500`.
 * to include 75.5% of contexts in a variation, set the `weight` to `75500`. The weight must add up to 100% between all of the variations.
The below example shows how to rollout the `true` variation to 50% of contexts and the `false` variation to 50% of contexts on the default rule of a flag.
Here is how to set the rollout using JSON:
Default percentage rollout
```
1
| {
---|--- 
2
| "percentageRolloutConfig": {
3
| "contextKind": "user", // rolling out to user contexts,
4
| "bucketBy": "key", // by user key
5
| "variations": [
6
| {
7
| "variation": 0, // this part of the rollout serves the true variation
8
| "weight": 50000 // 50% of contexts will be served this variation
9
| },
10
| {
11
| "variation": 1, // this part of the rollout serves the false variation
12
| "weight": 50000 // 50% of contexts will be served this variation
13
| }
14
| ]
15
| }
16
| }
```
To learn how to create percentage rollouts in the UI, read [Percentage rollouts](/docs/home/releases/percentage-rollouts).
### Progressive rollout
A progressive rollout lets you serve a given flag variation to a specified percentage of contexts, and gradually increases that percentage over a specified time.
Here is what a progressive rollout looks like in the UI:
![A progressive rollout.](https://files.buildwithfern.com/https://launchdarkly.docs.buildwithfern.com/docs/185aea3866cb35b2a698515ec14ed5410d75fa46de27d4deb38470da7fd2115a/assets/images/auto/progressive-rollout-flag-targeting-in-progress.auto.png)
A progressive rollout.
To create a progressive rollout, use `progressiveRolloutConfig` with the following key/value pairs:
 * `contextKind`: the context kind you want to roll out by. Defaults to your [default context kind](/docs/home/flags/context-kinds#built-in-context-kinds).
 * `controlVariation`: the variation ID of the variation you want to serve at the beginning of the rollout. For boolean flags, this variation is automatically set based on the value the flag is currently serving, usually the [off variation](/docs/home/flags/off-variation) or the [default variation](/docs/home/flags/default-rule).
 * `endVariation`: the variation ID of the variation you want to roll out over time. For boolean flags, this variation is automatically set based on the variation not currently being served.
 * `steps`, with the following key/value pairs:
 * `rolloutWeight`: the percentage of contexts you want to include in that rollout step. Include three decimal places in the percentage, with no `.` or `,`. Do not include leading `0`s. For example, to include 5.5% of contexts in a rollout step, set the `rolloutWeight` to `5500`. To include 10.5% of contexts in a variation, set the `rolloutWeight` to `10500`. The weight must add up to 100% between all of the rollout steps.
 * `duration` with the following key/value pairs:
 * `quantity`: the length of time you want that step in the rollout to last, in the units specified in `unit`.
 * `unit`: the unit of time you want to use in the rollout. Options include:
 * `day`
 * `hour`
 * `minute`
The below example shows a progressive rollout over 20 hours on the default rule of a flag.
Here is how to set the rollout using JSON:
Default progressive rollout
```
1
| {
---|--- 
2
| "fallthrough": {
3
| "progressiveRolloutConfig": {
4
| "contextKind": "user", // rolling out by user context kind
5
| "controlVariation": 1, // the starting variation is false. Not required for boolean flags
6
| "endVariation": 0, // the flag is rolling out to true. Not required for boolean flags
7
| "steps": [
8
| {
9
| "rolloutWeight": 1000, // 1% of contexts are in the first step
10
| "duration": {
11
| "quantity": 4,
12
| "unit": "hour" // each step will take four hours
13
| }
14
| },
15
| {
16
| "rolloutWeight": 5000, // 5% of contexts are in the second step
17
| "duration": {
18
| "quantity": 4,
19
| "unit": "hour"
20
| }
21
| },
22
| {
23
| "rolloutWeight": 10000, // 10% of contexts are in the third step
24
| "duration": {
25
| "quantity": 4,
26
| "unit": "hour"
27
| }
28
| },
29
| {
30
| "rolloutWeight": 25000, // 25% of contexts are in the fourth step
31
| "duration": {
32
| "quantity": 4,
33
| "unit": "hour"
34
| }
35
| },
36
| {
37
| "rolloutWeight": 50000, // 50% of contexts are in the fourth step
38
| "duration": {
39
| "quantity": 4,
40
| "unit": "hour"
41
| }
42
| }
43
| ]
44
| }
45
| }
46
| }
```
To learn how to build progressive rollouts in the UI, read [Progressive rollouts](/docs/home/releases/progressive-rollouts).
### Guarded rollout
Guarded rollouts let you attach a metric to a rollout to monitor the performance of a flag over time, and to take action on the results.
Here is what a guarded rollout setup looks like in the UI:
![The guarded rollout setup options on a flag rule.](https://files.buildwithfern.com/https://launchdarkly.docs.buildwithfern.com/docs/a2132c6a5cd28832b2fba2eac72cacdfe495f8dfaaf843e2dd35f08d34142557/assets/images/__toPlaywright_newIA/flag-targeting-add-rollout-menu-new.png)
The guarded rollout setup options on a flag rule.
To create a guarded rollout, use `guardedRolloutConfig` with the following key/value pairs:
 * `randomizationUnit`: the context kind you want to target by.
 * `stages` with the following key/value pairs:
 * `monitoringWindowMilliseconds`: the length of time you want that step in the rollout to last, in milliseconds.
 * `rolloutWeight`: the percentage of contexts you want to include in that rollout step. Include three decimal places in the percentage, with no `.` or `,`. Do not include leading `0`s. For example, to include 5.5% of contexts in a rollout step, set the `rolloutWeight` to `5500`. To include 10.5% of contexts in a variation, set the `rolloutWeight` to `10500`. The weight must add up to 100% between all of the rollout steps.
 * `metrics` with the following key/value pairs:
 * `metricKey`: the key of the metric you want to monitor.
 * `onRegression` with the following key/value pair:
 * `rollback`: whether or not you want LaunchDarkly to automatically roll back the release in the event of a regression. Options include `true` or `false`.
 * `regressionThreshold`: the [regression threshold](/docs/home/releases/regression-thresholds) you want for the metric.
The below example shows a guarded rollout over 24 hours on the default rule of a flag, using a metric called `sentry-errors`.
Here is how to set the guarded rollout using JSON:
Guarded rollout
```
1
| {
---|--- 
2
| "guardedRolloutConfig": {
3
| "randomizationUnit": "request", // the context kind to target by
4
| "controlVariation": 1, // the starting variation is false. Not required for boolean flags
5
| "endVariation": 0, // the flag is rolling out to true. Not required for boolean flags
6
| "stages": [
7
| {
8
| "monitoringWindowMilliseconds": 17280000, // this stage lasts 4.8 hours
9
| "rolloutWeight": 1000 // 1% of contexts are in the first stage
10
| },
11
| {
12
| "monitoringWindowMilliseconds": 17280000, // this stage lasts 4.8 hours
13
| "rolloutWeight": 5000 // 5% of contexts are in the second stage
14
| },
15
| {
16
| "monitoringWindowMilliseconds": 17280000, // this stage lasts 4.8 hours
17
| "rolloutWeight": 10000 // 10% of contexts are in the third stage
18
| },
19
| {
20
| "monitoringWindowMilliseconds": 17280000, // this stage lasts 4.8 hours
21
| "rolloutWeight": 25000 // 25% of contexts are in the fourth stage
22
| },
23
| {
24
| "monitoringWindowMilliseconds": 17280000, // this stage lasts 4.8 hours
25
| "rolloutWeight": 50000 // 50% of contexts are in the fifth stage
26
| }
27
| ],
28
| "metrics": [
29
| {
30
| "metricKey": "sentry-errors", // the metric key
31
| "onRegression": { // if a regression is detected, then
32
| "rollback": true, // LaunchDarkly will automatically roll back the release
33
| },
34
| "regressionThreshold": 0.01 // the custom regression threshold for the metric is set to 1%
35
| }
36
| ]
37
| }
38
| }
```
To learn how to build guarded rollouts in the UI, read [Guarded rollouts](/docs/home/releases/guarded-rollouts).
## Example JSON targeting
This section includes an example of a flag with several targeting rules.
This flag:
 * is toggled on
 * has one prerequisite flag
 * is targeting two individuals
 * is targeting a segment
 * has an active guarded rollout
Here is what the targeting rules look like in the UI:
![A flag with several targeting rules.](https://files.buildwithfern.com/https://launchdarkly.docs.buildwithfern.com/docs/a0de505d1cc01e8c22d6b55781371a542b57682ea8d4446d0108c741562b9b9d/assets/images/__toPlaywright_newIA/flag-targeting-json-example.png)
A flag with several targeting rules.
Here are the flag targeting rules in JSON:
Example flag targeting
```
1
| {
---|--- 
2
| "offVariation": 1, // the off variation is false
3
| "on": true, // the flag is on
4
| "prerequisites": [ // requires a prerequisite flag that must serve true
5
| {
6
| "key": "enable-cloud-database",
7
| "variation": 1
8
| }
9
| ],
10
| "contextTargets": [ // individually targets two user contexts
11
| {
12
| "values": [
13
| "context-key-123abc",
14
| "context-key-456def"
15
| ],
16
| "contextKind": "user",
17
| "variation": 0
18
| }
19
| ],
20
| "rules": [
21
| {
22
| "clauses": [ // targets a segment
23
| {
24
| "attribute": "segmentMatch",
25
| "contextKind": "user",
26
| "negate": false,
27
| "op": "segmentMatch",
28
| "values": [
29
| "internal-testers-on-production"
30
| ]
31
| }
32
| ],
33
| "description": "",
34
| "variation": 0
35
| }
36
| ],
37
| "fallthrough": { // the default rule is a guarded rollout
38
| "guardedRolloutConfig": {
39
| "stages": [
40
| {
41
| "rolloutWeight": 1000, // rolling out to 1%
42
| "monitoringWindowMilliseconds": 17280000
43
| },
44
| {
45
| "rolloutWeight": 5000, // rolling out to 5%
46
| "monitoringWindowMilliseconds": 17280000
47
| },
48
| {
49
| "rolloutWeight": 10000, // rolling out to 10%
50
| "monitoringWindowMilliseconds": 17280000
51
| },
52
| {
53
| "rolloutWeight": 25000, // rolling out to 25%
54
| "monitoringWindowMilliseconds": 17280000
55
| },
56
| {
57
| "rolloutWeight": 50000, // rolling out to 50%
58
| "monitoringWindowMilliseconds": 17280000
59
| }
60
| ],
61
| "metrics": [
62
| {
63
| "metricKey": "cart-purchases",
64
| "regressionThreshold": 0,
65
| "onRegression": {
66
| "rollback": false,
67
| "notify": true
68
| }
69
| }
70
| ],
71
| "randomizationUnit": "user"
72
| }
73
| }
74
| }
```
[![Logo](https://files.buildwithfern.com/https://launchdarkly.docs.buildwithfern.com/docs/a8964c2c365fb94c416a0e31ff873d21ce0c3cbf40142e7e66cce5ae08a093af/assets/logo-dark.svg)![Logo](https://files.buildwithfern.com/https://launchdarkly.docs.buildwithfern.com/docs/a8964c2c365fb94c416a0e31ff873d21ce0c3cbf40142e7e66cce5ae08a093af/assets/logo-dark.svg)](/docs/home)
LaunchDarkly docs
LaunchDarkly docs
LaunchDarkly docs
LaunchDarkly docs