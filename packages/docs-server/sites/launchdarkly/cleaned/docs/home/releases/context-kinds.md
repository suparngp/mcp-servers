`/`
[Product docs](/docs/home)[Guides](/docs/guides)[SDKs](/docs/sdk)[Integrations](/docs/integrations)[API docs](/docs/api)[Tutorials](/docs/tutorials)[Flagship Blog](/docs/blog)
 * Getting started
 * [Overview](/docs/home)
 * [Launch Insights](/docs/home/getting-started/launch-insights)
 * [LaunchDarkly architecture](/docs/home/getting-started/architecture)
 * [LaunchDarkly vocabulary](/docs/home/getting-started/vocabulary)
 * Feature flags and AI Configs
 * [Create flags](/docs/home/flags/create)
 * [Target with flags](/docs/home/flags/target)
 * [Flag templates](/docs/home/flags/templates)
 * [Manage flags](/docs/home/flags/manage)
 * [Code references](/docs/home/flags/code-references)
 * [AI Configs](/docs/home/ai-configs)
 * [Contexts](/docs/home/flags/contexts)
 * [Segments](/docs/home/flags/segments)
 * Releases
 * [Releasing features with LaunchDarkly](/docs/home/releases/releasing)
 * [Release policies](/docs/home/releases/release-policies)
 * [Percentage rollouts](/docs/home/releases/percentage-rollouts)
 * [Progressive rollouts](/docs/home/releases/progressive-rollouts)
 * [Guarded rollouts](/docs/home/releases/guarded-rollouts)
 * [Feature monitoring](/docs/home/releases/feature-monitoring)
 * [Release pipelines](/docs/home/releases/release-pipelines)
 * [Engineering insights](/docs/home/releases/eng-insights)
 * [Release management tools](/docs/home/releases/release-management)
 * [Applications and app versions](/docs/home/releases/apps-and-app-versions)
 * [Change history](/docs/home/releases/change-history)
 * Observability
 * [Observability](/docs/home/observability)
 * [Session replay](/docs/home/observability/session-replay)
 * [Error monitoring](/docs/home/observability/errors)
 * [Logs](/docs/home/observability/logs)
 * [Traces](/docs/home/observability/traces)
 * [LLM observability](/docs/home/observability/llm-observability)
 * [Alerts](/docs/home/observability/alerts)
 * [Dashboards](/docs/home/observability/dashboards)
 * [Search specification](/docs/home/observability/search)
 * [Observability settings](/docs/home/observability/settings)
 * [Vega](/docs/home/observability/vega)
 * Product analytics
 * [Product analytics](/docs/home/product-analytics)
 * [Setting up product analytics](/docs/home/product-analytics/setup)
 * [Using product analytics charts](/docs/home/product-analytics/chart)
 * Experimentation
 * [Experimentation](/docs/home/experimentation)
 * [Creating experiments](/docs/home/experimentation/create)
 * [Managing experiments](/docs/home/experimentation/manage)
 * [Analyzing experiments](/docs/home/experimentation/analyze)
 * [Experimentation and metric events](/docs/home/experimentation/events)
 * [Multi-armed bandits](/docs/home/multi-armed-bandits)
 * [Holdouts](/docs/home/holdouts)
 * Metrics
 * [Metrics](/docs/home/metrics)
 * [Metric groups](/docs/home/metrics/metric-groups)
 * [Autogenerated metrics](/docs/home/metrics/autogen-metrics)
 * [Metric impact](/docs/home/metrics/metric-impact)
 * [Metric events](/docs/home/metrics/metric-events)
 * Warehouse native
 * [Warehouse native Experimentation](/docs/home/warehouse-native)
 * [Warehouse native metrics](/docs/home/warehouse-native/metrics)
 * [Creating warehouse native experiments](/docs/home/warehouse-native/creating)
 * Infrastructure
 * [Connect apps and services to LaunchDarkly](/docs/home/infrastructure/apps)
 * [LaunchDarkly in China and Pakistan](/docs/home/infrastructure/china)
 * [LaunchDarkly in the European Union (EU)](/docs/home/infrastructure/eu)
 * [LaunchDarkly in federal environments](/docs/home/infrastructure/federal)
 * [Public IP list](/docs/home/infrastructure/ip-list)
 * Your account
 * [Projects](/docs/home/account/project)
 * [Views](/docs/home/account/views)
 * [Environments](/docs/home/account/environment)
 * [Tags](/docs/home/account/tags)
 * [Teams](/docs/home/account/teams)
 * [Members](/docs/home/account/members)
 * [Roles](/docs/home/account/roles)
 * [Account security](/docs/home/account/secure)
 * [Billing and usage](/docs/home/account/billing)
 * [Changelog](/docs/home/changelog)
[Sign in](/)[Sign up](https://app.launchdarkly.com/signup)
On this page
 * [Overview](#overview)
 * [Randomization units](#randomization-units)
 * [Choose the randomization unit](#choose-the-randomization-unit)
 * [Requests](#requests)
 * [Users](#users)
 * [Multi-contexts](#multi-contexts)
 * [Make context kinds available](#make-context-kinds-available)
## Overview
This topic explains how to set up context kinds for use in guarded rollouts.
##### Guarded rollouts availability
All LaunchDarkly accounts include a limited trial of guarded rollouts. Use them to see how well the feature supports your release process in production.
## Randomization units
A guarded rollout uses a single [context kind](/docs/home/flags/context-kinds), called a randomization unit, to determine how to assign traffic to flag variations.
Most guarded rollouts use the `request` or `user` context kind as the randomization unit. This means the rollout assigns variations based on the request or the user evaluating the flag. You can also use another context kind, such as `device` or `organization`, depending on how your application is configured.
## Choose the randomization unit
The randomization unit must be available in both the flag and to any metrics you want to monitor.
We recommend choosing a randomization unit evaluated by a large number of unique contexts. This helps LaunchDarkly detect performance differences between variations more quickly.
##### Minimum context requirement for guarded rollouts
A minimum number of contexts must evaluate a new flag variation to advance to the next stage of the rollout. If this minimum sample size is not met, LaunchDarkly automatically rolls back the rollout.
### Requests
For backend-only changes, the `request` context kind is often the best choice. Systems typically generate many distinct requests, and backend metrics like latency and error rate are usually measured per request.
To use `request` contexts, [configure a context](/docs/sdk/features/context-config) with the `kind` set to `"request"` and a `key` that uniquely identifies the request and remains consistent throughout the request lifecycle:
```
1
| {
---|--- 
2
| "kind": "request",
3
| "key": "request-key-abc-123"
4
| }
```
### Users
A `user` randomization unit is often the best choice for:
 * Frontend-only changes
 * Backend changes that may affect frontend metrics
 * Backend changes that may impact performance outside the scope of the current request
##### Use distinct user keys
Most LaunchDarkly SDKs use `user` contexts by default. Ensure that your user keys uniquely identify individual users of your application. If they represent something else, such as organizations or requests, rollouts may not behave as expected.
To use `user` contexts, [configure a context](/docs/sdk/features/context-config) with the `kind` set to `"user"` and a `key` that uniquely identifies the user across all interactions:
```
1
| {
---|--- 
2
| "kind": "user",
3
| "key": "user-key-123abc",
4
| "name": "Anna"
5
| }
```
If your application supports both logged-in and logged-out end users, make sure each user has a distinct key that remains consistent throughout their experience. To learn more, read [Managing experiments with logged-out and logged-in end users](/docs/guides/experimentation/logged-out-logged-in).
### Multi-contexts
To make a context kind available for use in your guarded rollouts, you must instrument your application code consistently. To simplify this, we recommend using [multi-contexts](/docs/home/flags/multi-contexts) to include multiple context kinds in each evaluation.
For example, if your application has both a frontend and a backend service:
 * On the client side, [set the current context](/docs/sdk/features/identify) to a multi-context that includes all the contexts the frontend knows about, such as `user` and `device`.
 * On the server side, create a multi-context that includes all the contexts the backend knows about, such as `user` and `request`. Use this multi-context when [evaluating flags](/docs/sdk/features/evaluating).
 * Use the same multi-context in any [custom event](/docs/sdk/features/events) tracking calls to ensure consistency with flag evaluations.
 * In larger codebases, use middleware to consistently set the LaunchDarkly context for each request.
## Make context kinds available
In LaunchDarkly, the default context kind of `user` is automatically available for use in guarded rollouts. If you have created other context kinds and want to use them as randomization units, make sure they are marked as **Available for experiments and guarded rollouts**. To learn more, read [Randomization units other than “user”](/docs/home/experimentation/randomization#randomization-units-other-than-user).
![The "New context kind" dialog with the "Available for experiments and guarded rollouts" option checked.](https://files.buildwithfern.com/https://launchdarkly.docs.buildwithfern.com/docs/95fc5eadef8eeacde9df7d7b43c44262758f47785d7f5517369b1ee2a67d7be3/assets/images/__toPlaywright_newIA/edit-context-kind-rand-unit.png)
The "New context kind" dialog with the "Available for experiments and guarded rollouts" option checked.
After that, you can configure any metrics that apply to that context kind to use it as a randomization unit.
![The "Metric definition" section of a new metric with the randomization unit called out.](https://files.buildwithfern.com/https://launchdarkly.docs.buildwithfern.com/docs/c1f430997989c8e2d46409daf3d076f16bdac1bd14f413efbb8678803dc55cd8/assets/images/auto/metric-randomization-unit.auto.png)
The "Metric definition" section of a new metric with the randomization unit called out.
When creating a guarded rollout, you must choose a randomization unit supported by all the metrics you want to monitor. Only context kinds supported by the selected metrics’ randomization units are available for guarded rollouts.
[![Logo](https://files.buildwithfern.com/https://launchdarkly.docs.buildwithfern.com/docs/a8964c2c365fb94c416a0e31ff873d21ce0c3cbf40142e7e66cce5ae08a093af/assets/logo-dark.svg)![Logo](https://files.buildwithfern.com/https://launchdarkly.docs.buildwithfern.com/docs/a8964c2c365fb94c416a0e31ff873d21ce0c3cbf40142e7e66cce5ae08a093af/assets/logo-dark.svg)](/docs/home)
LaunchDarkly docs
LaunchDarkly docs
LaunchDarkly docs
LaunchDarkly docs